<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Profile</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style4.css') }}">
</head>
<body>
    <nav class="navbar">
        <a href="/todo" class="nav-link">To Do</a>
        <a href="/plan" class="nav-link">Plan</a>
        <a href="/user" class="nav-link clickedNav">User</a>
    </nav>

    <div class="user-profile-container">
        <header class="profile-header">
            <h1>User Profile</h1>
            <p>Welcome to your Workout Journey!!!</p>
        </header>

        <h2 class="user-name">{{ user.username }}</h2>

        <div class="personal-info">
            <h3>Personal Info:</h3>
            <p>Name: {{ user.name }}</p>
            <p>Sex: {{ user.sex }}</p>
            <p>Height: {{ user.height }} cm</p>
            <p>Weight: {{ user.weight }} kg</p>
            <p>Goal Weight: {{ user.goal_weight }} kg</p>
        </div>

        <div class="workout-track">
            <div class="track-header">
                <h3>Workout Calendar</h3>
            </div>
            <div class="calendar-grid" id="workout-calendar">
            </div>
        </div>

        <div class="profile-buttons">
            <button class="update-profile-btn" onclick="window.location.href='/update';">Update My Profile</button>
            <button class="generate-plan-btn">Generate Weekly Plan</button>
            <button class="check-data-btn" onclick="window.location.href='/data';">Check My Data</button>
        </div>
        <button class="logout-btn" onclick="window.location.href='/logout';">Log Out</button>

        <footer class="profile-footer">
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et.</p>
            <p>All rights reserved. <a href="#">Privacy policy</a></p>
        </footer>
    </div>
</body>
<script>
    document.querySelector('.generate-plan-btn').addEventListener('click', function() {
        fetch('/api/generate-weekly-plan', {
            method: 'POST', 
            headers: {
                'Content-Type': 'application/json'
            }
        })
        .then(response => response.json())
        .then(result => {
            if (result.success) {
                alert('Weekly plan generated successfully!');
                console.log('Generated plan:', result.plan); 
            } else {
                alert('Failed to generate weekly plan: ' + result.message);
            }
        })
        .catch(error => {
            console.error('Error generating weekly plan:', error);
            alert('An error occurred while generating the weekly plan.');
        });
    });


    function generateWorkoutCalendar(workoutData) {
        const calendar = document.getElementById("workout-calendar");

        // 获取当前月份的天数
        const now = new Date();
        const year = now.getFullYear();
        const month = now.getMonth(); // 当前月份 (0-11)
        const daysInMonth = new Date(year, month + 1, 0).getDate();

        // 遍历当月的每一天
        for (let day = 1; day <= daysInMonth; day++) {
            const dateStr = `${year}-${String(month + 1).padStart(2, "0")}-${String(day).padStart(2, "0")}`;
            const intensity = workoutData[dateStr] || 0; // 默认为 0，无任务

            // 创建格子
            const dayCell = document.createElement("div");
            dayCell.setAttribute("data-intensity", intensity);
            dayCell.title = `Date: ${dateStr}\nTasks: ${intensity}`;
            calendar.appendChild(dayCell);
        }
    }

    // 从后端获取数据
    fetch("/api/workout-data")
        .then((response) => response.json())
        .then((data) => {
            generateWorkoutCalendar(data);
        })
        .catch((error) => console.error("Error fetching workout data:", error));

</script>
</html>
